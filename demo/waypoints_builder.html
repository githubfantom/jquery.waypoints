<!DOCTYPE HTML>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>jQuery waypoints Builder</title>
	<style>
		* {
			padding: 0;
			margin: 0;
		}
		html, body {
			width: 100%;
			height: 100%
		}
		html, body {
			margin:0;
			padding:0;
			width:100%;
			height:100%;
			font-size:12px;
		}
		#area {
			border:1px solid gray;
			background: url(img/grid.png);
		}
		textarea {
			width:50%;
			height:100px;
		}
	</style>
	<script type="text/javascript" src="js/raphael-2.1.0.min.js"></script>
	<script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>
	<script type="text/javascript">
		$(function(){
			var path = [];
			var paper = '';
			
			$('#area').live('click', function(e){
				var offset = $('#area').offset(); 
				var x = e.pageX - offset.left;
				var y = e.pageY - offset.top;
				CreatePath(x, y);
			});
			
			$('button').live('click', function(){
				init();
			});
			
			function CreatePath(x, y)
			{
				var a = [x, y];
				
				var p = paper.circle(x, y, 10);
				p.attr('stroke', 'gray');
				
				var len = path.length;
				if(len){
					var x1 = path[(len-1)][0];
					var y1 = path[(len-1)][1];
				}else
				{
					var x1 = x;
					var y1 = y;
				}
				
				var l = paper.path("M"+x1+" "+y1+"L"+x+" "+y+"");
				l.attr('stroke', 'gray');
				l.attr('stroke-dasharray', '. ');
				l.attr('stroke-linecap', 'round');
				l.attr('title', 'round');
				
				path.push(a);
				
				var waypoints_str = 'var waypoints = [';
				var len = path.length;
				var sep = '';
				$.each(path, function(idx, obj){
					sep = idx+1 < len?', ':'';
					waypoints_str += '['+obj[0]+','+obj[0]+']'+sep;
				});
				waypoints_str += '];';
				$('#waypoints').html(waypoints_str);
			}
			
			function init()
			{
				path = [];
				
				var areaWidth = $("#area-width").val();
				var areaHeight = $("#area-height").val();
				
				$("#area").remove();
				$("#wrapper").html('<div id="area"></div>');
				
				$("#area").css({
					width: areaWidth
					,height: areaHeight
				});
				
				// Raphael init
				paper = Raphael("area", areaWidth, areaHeight);
			}
			
			init();
		});
	</script>
</head>
<body>
	<textarea id="waypoints"></textarea>
	<table>
		<tr valign="top">
			<td>
				<table>
					<tr><td>Width:</td><td><input type="text" id="area-width" value="500"></td></tr>
					<tr><td>Height:</td><td><input type="text" id="area-height" value="500"></td></tr>
				</table>
				<button>Build</button>
			</td>
			<td>
				<div id="wrapper"></div>
			</td>
		</tr>
	</table> 
</body>
</html>